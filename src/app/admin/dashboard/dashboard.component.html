<!-- dashboard.component.html -->
<div class="min-h-screen bg-gray-50 relative">
    <!-- Overlay para móvil cuando el sidebar está abierto -->
    <div *ngIf="isSidebarOpen" class="fixed inset-0 bg-gray-600 bg-opacity-50 transition-opacity md:hidden z-20"
        (click)="toggleSidebar()">
    </div>

    <!-- Sidebar -->
    <aside
        class="fixed top-0 left-0 h-screen bg-white shadow-lg transform transition-transform duration-300 ease-in-out z-30"
        [ngClass]="{'translate-x-0 w-64': isSidebarOpen || windowWidth >= 768, '-translate-x-full w-64 md:translate-x-0': !isSidebarOpen}">

        <!-- Logo y Header -->
        <div class="p-6 bg-gradient-to-r from-blue-600 to-blue-700">
            <img src="/img/Logo.avif" alt="LoopMotion Logo" class="h-12 mx-auto mb-4 brightness-0 invert">
            <h2 class="text-xl font-bold text-white text-center">Panel de Control</h2>
        </div>

        <!-- Perfil del Admin -->
        <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                <img src="https://img.icons8.com/fluency/48/administrator-male.png" class="w-6 h-6">
              </div>
              <div>
                <p class="text-sm font-medium text-gray-900">{{ userName || 'Cargando...' }}</p>
                <p class="text-xs text-gray-500">{{ userEmail || 'Cargando...' }}</p>
              </div>
            </div>
            <button 
            (click)="logout()"
            class="mt-4 w-full flex items-center justify-center px-4 py-2 text-sm text-red-600 bg-red-50 rounded-lg hover:bg-red-100 transition-colors">
            <img src="https://img.icons8.com/fluency/48/exit.png" class="w-4 h-4 mr-2">
            Cerrar Sesión
        </button>
          </div>

        <!-- Navegación -->
        <nav class="mt-6 px-4">
            <div class="space-y-2">
                <button (click)="changeView('dashboard')"
                    class="w-full flex items-center px-4 py-3 text-gray-600 rounded-lg hover:bg-blue-50 transition-colors"
                    [ngClass]="{'bg-blue-50 text-blue-600': currentView === 'dashboard'}">
                    <img src="https://img.icons8.com/fluency/48/dashboard.png" class="w-5 h-5 mr-3">
                    <span class="font-medium">Dashboard</span>
                </button>
                <button (click)="changeView('new-project')"
                    class="w-full flex items-center px-4 py-3 text-gray-600 rounded-lg hover:bg-blue-50 transition-colors"
                    [ngClass]="{'bg-blue-50 text-blue-600': currentView === 'new-project'}">
                    <img src="https://img.icons8.com/fluency/48/add-file.png" class="w-5 h-5 mr-3">
                    <span class="font-medium">Nuevo proyecto</span>
                </button>
                <button (click)="changeView('projects')"
                    class="w-full flex items-center px-4 py-3 text-gray-600 rounded-lg hover:bg-blue-50 transition-colors"
                    [ngClass]="{'bg-blue-50 text-blue-600': currentView === 'projects' || currentView === 'project-detail'}">
                    <img src="https://img.icons8.com/fluency/48/project.png" class="w-5 h-5 mr-3">
                    <span class="font-medium">Proyectos</span>
                    <span class="ml-auto bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs">
                        {{activeProjects.length}}
                    </span>
                </button>
                <button (click)="changeView('potential-clients')"
                    class="w-full flex items-center px-4 py-3 text-gray-600 rounded-lg hover:bg-blue-50 transition-colors"
                    [ngClass]="{'bg-blue-50 text-blue-600': currentView === 'potential-clients'}">
                    <img src="https://img.icons8.com/fluency/48/business.png" class="w-5 h-5 mr-3">
                    <span class="font-medium">Posibles Clientes</span>
                    <span *ngIf="clientsData?.length" class="ml-auto bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs">
                        {{clientsData.length}}
                    </span>
                </button>
                <button (click)="changeView('contacts')"
                    class="w-full flex items-center px-4 py-3 text-gray-600 rounded-lg hover:bg-blue-50 transition-colors"
                    [ngClass]="{'bg-blue-50 text-blue-600': currentView === 'contacts'}">
                    <img src="https://img.icons8.com/fluency/48/communication.png" class="w-5 h-5 mr-3">
                    <span class="font-medium">Contactos</span>
                    <span class="ml-auto bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs">
                        {{contacts.length}}
                    </span>
                </button>
                <button (click)="changeView('quotations')"
                    class="w-full flex items-center px-4 py-3 text-gray-600 rounded-lg hover:bg-blue-50 transition-colors"
                    [ngClass]="{'bg-blue-50 text-blue-600': currentView === 'quotations' || currentView === 'quotation-detail'}">
                    <img src="https://img.icons8.com/fluency/48/documents.png" class="w-5 h-5 mr-3">
                    <span class="font-medium">Cotizaciones</span>
                    <span class="ml-auto bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs">
                        {{quotations.length}}
                    </span>
                </button>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="transition-all duration-300 ease-in-out" [ngClass]="{'md:ml-64': isSidebarOpen || windowWidth >= 768}">
        <!-- Top Bar -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="px-4 sm:px-6 lg:px-8 py-4 flex items-center">
                <button class="md:hidden mr-4" (click)="toggleSidebar()">
                    <img src="https://img.icons8.com/fluency/48/menu.png" class="w-6 h-6">
                </button>
                <h1 class="text-lg sm:text-xl font-semibold text-gray-800">
                    {{currentView === 'dashboard' ? 'Dashboard' :
                    currentView === 'new-project' ? 'Nuevo proyecto | Asignacion de proyecto' :
                    currentView === 'contacts' ? 'Contactos' :
                    currentView === 'quotations' ? 'Cotizaciones' : 'Detalles'}}
                </h1>
            </div>
        </header>

        <!-- Content Area -->
        <main class="p-4 sm:p-6 lg:p-8">
            <!-- Dashboard View -->
            <div *ngIf="currentView === 'dashboard'" class="space-y-6">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Total Contactos</p>
                                <p class="text-2xl font-bold text-gray-900 mt-1">{{contacts.length}}</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/communication.png" class="w-6 h-6">
                            </div>
                        </div>
                        <div class="mt-4 flex items-center text-sm">
                            <span class="text-green-500 flex items-center">
                                <img src="https://img.icons8.com/fluency/48/up.png" class="w-4 h-4 mr-1">
                                12%
                            </span>
                            <span class="text-gray-400 ml-2">vs mes anterior</span>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Cotizaciones</p>
                                <p class="text-2xl font-bold text-gray-900 mt-1">{{quotations.length}}</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/documents.png" class="w-6 h-6">
                            </div>
                        </div>
                        <div class="mt-4 flex items-center text-sm">
                            <span class="text-green-500 flex items-center">
                                <img src="https://img.icons8.com/fluency/48/up.png" class="w-4 h-4 mr-1">
                                8%
                            </span>
                            <span class="text-gray-400 ml-2">vs mes anterior</span>
                        </div>
                    </div>
                    
                    <!-- Card de Proyectos Activos -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Proyectos Activos</p>
                                <p class="text-2xl font-bold text-gray-900 mt-1">{{activeProjects.length}}</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/project.png" class="w-6 h-6">
                            </div>
                        </div>
                        <div class="mt-4 flex items-center text-sm">
                            <span class="text-green-500 flex items-center">
                                <img src="https://img.icons8.com/fluency/48/up.png" class="w-4 h-4 mr-1">
                                15%
                            </span>
                            <span class="text-gray-400 ml-2">vs mes anterior</span>
                        </div>
                    </div>
                    
                    <!-- Card de Ingresos Totales (Opcional) -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Ingresos Totales</p>
                                <p class="text-2xl font-bold text-gray-900 mt-1">${{totalRevenue.toLocaleString('es-MX')}}</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/money.png" class="w-6 h-6">
                            </div>
                        </div>
                        <div class="mt-4 flex items-center text-sm">
                            <span class="text-green-500 flex items-center">
                                <img src="https://img.icons8.com/fluency/48/up.png" class="w-4 h-4 mr-1">
                                20%
                            </span>
                            <span class="text-gray-400 ml-2">vs mes anterior</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6">
                        <h2 class="text-lg font-semibold text-gray-900">Actividad Reciente</h2>
                    </div>
                    <div class="border-t border-gray-200">
                        <div class="divide-y divide-gray-200">
                            <div *ngFor="let quote of quotations.slice(0,5)" class="p-6 hover:bg-gray-50">
                                <div class="flex items-center">
                                    <div
                                        class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                        <img src="https://img.icons8.com/fluency/48/documents.png" class="w-5 h-5">
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">
                                            Nueva cotización de {{quote.personalInfo.company}}
                                        </p>
                                        <p class="text-sm text-gray-500">
                                            Proyecto: {{quote.projectInfo.projectType}}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contacts View -->
            <div *ngIf="currentView === 'contacts'" class="space-y-6">
                <!-- Header with search -->
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900">Mensajes de Contacto</h2>
                            <p class="text-sm text-gray-500">{{contacts.length}} mensajes recibidos</p>
                        </div>
                        <div class="w-full sm:w-auto">
                            <div class="relative">
                                <input type="text" placeholder="Buscar mensajes..." [(ngModel)]="searchText" 
                                class="w-full sm:w-64 pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <img src="https://img.icons8.com/fluency/48/search.png"
                                class="w-5 h-5 absolute left-3 top-2.5">                            
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Cards -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    <div *ngFor="let contact of filteredContacts()"
                        class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-grow">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                        <span
                                            class="text-blue-600 font-semibold">{{contact.name.charAt(0).toUpperCase()}}</span>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">{{contact.name}}</h3>
                                        <p class="text-sm text-gray-500">{{contact.email}}</p>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <p class="text-gray-600">{{contact.message}}</p>
                                </div>
                            </div>
                            <button class="p-2 hover:bg-gray-100 rounded-full">
                                <img src="https://img.icons8.com/fluency/48/more.png" class="w-5 h-5">
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quotations View -->
            <div *ngIf="currentView === 'quotations'" class="space-y-6">
                <!-- Header with filters -->
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900">Solicitudes de Cotización</h2>
                            <p class="text-sm text-gray-500">{{quotations.length}} cotizaciones pendientes</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <!-- <select
                                class="px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option>Todos los estados</option>
                                <option>Aceptadas</option>
                                <option>Rechazadas</option>
                            </select> -->
                            <button
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Exportar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quotations List -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="grid divide-y divide-gray-200">
                        <div *ngFor="let quote of quotations" (click)="showQuotationDetail(quote)"
                            class="p-4 sm:p-6 hover:bg-gray-50 cursor-pointer transition-colors">
                            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                                <div class="flex items-center space-x-4">
                                    <div
                                        class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-purple-100 flex-shrink-0 flex items-center justify-center">
                                        <img src="https://img.icons8.com/fluency/48/document.png"
                                            class="w-5 h-5 sm:w-6 sm:h-6">
                                    </div>
                                    <div class="min-w-0">
                                        <h3 class="text-base sm:text-lg font-semibold text-gray-900 truncate">
                                            {{quote.personalInfo.company}}</h3>
                                        <p class="text-xs sm:text-sm text-gray-500 truncate">{{quote.personalInfo.name}}
                                            • {{quote.personalInfo.email}}</p>
                                    </div>
                                </div>
                                <div class="flex flex-row sm:flex-col items-center sm:items-end gap-2 sm:gap-1">
                                    <span
                                        class="px-2 sm:px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs sm:text-sm whitespace-nowrap">
                                        {{quote.projectInfo.projectType}}
                                    </span>
                                    <p class="text-xs sm:text-sm text-gray-500">Presupuesto: {{quote.budgetInfo.budget}}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quotation Detail View -->
            <div *ngIf="currentView === 'quotation-detail' && selectedQuotation" class="space-y-6">
                <!-- Header -->
                <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                    <div class="flex flex-col sm:flex-row sm:items-center gap-4">
                        <div class="flex items-center space-x-4">
                            <button (click)="goBack()" class="p-2 hover:bg-gray-100 rounded-full">
                                <img src="https://img.icons8.com/fluency/48/back.png" class="w-5 h-5">
                            </button>
                            <div>
                                <h2 class="text-lg font-semibold text-gray-900">Detalles de Cotización</h2>
                                <p class="text-sm text-gray-500 truncate">{{selectedQuotation.personalInfo.company}}</p>
                            </div>
                        </div>
                        <!-- <div class="flex gap-2 sm:ml-auto">
                            <button
                            (click)="showConfirmation('reject')"
                            [disabled]="selectedQuotation?.status === 'rejected'"
                            class="flex-1 sm:flex-none px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                            <img 
                                *ngIf="selectedQuotation?.status === 'rejected'"
                                src="https://img.icons8.com/fluency/48/cancel.png" 
                                class="w-4 h-4">
                            Rechazar
                        </button>
                        <button
                        (click)="showConfirmation('approve')"
                        [disabled]="selectedQuotation?.status === 'approved'"
                        class="flex-1 sm:flex-none px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                        <img 
                            *ngIf="selectedQuotation?.status === 'approved'"
                            src="https://img.icons8.com/fluency/48/checkmark.png" 
                            class="w-4 h-4 brightness-0 invert">
                        Aprobar
                    </button>
                        </div> -->
                    </div>
                    
                    
                </div>

                
                <!-- Content Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                    <!-- Información Personal -->
                    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Información Personal</h3>
                        <div class="space-y-4">
                            <div>
                                <p class="text-sm text-gray-500">Nombre</p>
                                <p class="font-medium text-gray-900">{{selectedQuotation.personalInfo.name}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Empresa</p>
                                <p class="font-medium text-gray-900">{{selectedQuotation.personalInfo.company}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Email</p>
                                <p class="font-medium text-gray-900">{{selectedQuotation.personalInfo.email}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Teléfono</p>
                                <p class="font-medium text-gray-900">{{selectedQuotation.personalInfo.phone}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Industria</p>
                                <p class="font-medium text-gray-900">{{selectedQuotation.personalInfo.industry}}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Información del Proyecto -->
                    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Información del Proyecto</h3>
                        <div class="space-y-4">
                            <div>
                                <p class="text-sm text-gray-500">Tipo de Proyecto</p>
                                <p class="font-medium text-gray-900">{{selectedQuotation.projectInfo.projectType}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Descripción</p>
                                <p class="font-medium text-gray-900 break-words">
                                    {{selectedQuotation.projectInfo.description}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Características</p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">
                                    <div *ngFor="let feature of selectedQuotation.projectInfo.features; let i = index"
                                        class="flex items-center space-x-2">
                                        <span class="w-3 sm:w-4 h-3 sm:h-4 rounded-full flex-shrink-0"
                                            [ngClass]="feature ? 'bg-green-500' : 'bg-red-500'"></span>
                                        <span class="text-xs sm:text-sm text-gray-600">Característica {{i + 1}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Información Técnica y Presupuesto -->
                    <div class="space-y-4 sm:space-y-6 md:col-span-2 lg:col-span-1">
                        <!-- Presupuesto -->
                        <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                            <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Información del
                                Presupuesto</h3>
                            <div class="grid sm:grid-cols-2 lg:grid-cols-1 gap-4">
                                <div>
                                    <p class="text-sm text-gray-500">Presupuesto</p>
                                    <p class="font-medium text-gray-900">{{selectedQuotation.budgetInfo.budget}}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Fecha de Inicio</p>
                                    <p class="font-medium text-gray-900">{{selectedQuotation.budgetInfo.startDate}}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Plazo</p>
                                    <p class="font-medium text-gray-900">{{selectedQuotation.budgetInfo.timeframe}}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Información Técnica -->
                        <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                            <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Información Técnica</h3>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-3 sm:gap-4">
                                    <div class="flex items-center space-x-2">
                                        <span class="w-3 sm:w-4 h-3 sm:h-4 rounded-full flex-shrink-0"
                                            [ngClass]="selectedQuotation.technicalInfo.hasContent ? 'bg-green-500' : 'bg-red-500'"></span>
                                        <span class="text-xs sm:text-sm text-gray-600">Contenido</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="w-4 h-4 rounded-full"
                                            [ngClass]="selectedQuotation.technicalInfo.hasDomain ? 'bg-green-500' : 'bg-red-500'"></span>
                                        <span class="text-sm text-gray-600">Dominio</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="w-4 h-4 rounded-full"
                                            [ngClass]="selectedQuotation.technicalInfo.hasHosting ? 'bg-green-500' : 'bg-red-500'"></span>
                                        <span class="text-sm text-gray-600">Hosting</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="w-4 h-4 rounded-full"
                                            [ngClass]="selectedQuotation.technicalInfo.hasLogo ? 'bg-green-500' : 'bg-red-500'"></span>
                                        <span class="text-sm text-gray-600">Logo</span>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Comentarios Adicionales</p>
                                    <p class="font-medium text-gray-900">
                                        {{selectedQuotation.technicalInfo.additionalComments}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="currentView === 'new-project'" class="space-y-6">
                <!-- Header -->
                <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                    <div class="flex flex-col sm:flex-row sm:items-center gap-4">
                        <div class="flex items-center space-x-4">
                            <button (click)="goBack()" class="p-2 hover:bg-gray-100 rounded-full">
                                <img src="https://img.icons8.com/fluency/48/back.png" class="w-5 h-5">
                            </button>
                            <div>
                                <h2 class="text-lg font-semibold text-gray-900">Nuevo Proyecto</h2>
                                <p class="text-sm text-gray-500">Creación detallada de proyecto</p>
                            </div>
                        </div>
                        <div class="flex gap-2 sm:ml-auto">
                            <button
                                (click)="saveProject()"
                                class="flex-1 sm:flex-none px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center justify-center gap-2">
                                <img src="https://img.icons8.com/fluency/48/save.png" class="w-4 h-4 brightness-0 invert">
                                Guardar Proyecto
                            </button>
                        </div>
                    </div>
                </div>
            
                <!-- Formulario Principal -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                    <!-- Información Básica del Proyecto -->
                    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Información del Proyecto</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="project-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre del Proyecto</label>
                                <input type="text" id="project-name" [(ngModel)]="newProject.name" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="project-type" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Proyecto</label>
                                <select id="project-type" [(ngModel)]="newProject.type" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="web">Desarrollo Web</option>
                                    <option value="mobile">Aplicación Móvil</option>
                                    <option value="ecommerce">E-Commerce</option>
                                    <option value="redesign">Rediseño</option>
                                    <option value="other">Otro</option>
                                </select>
                            </div>
                            <div>
                                <label for="project-description" class="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
                                <textarea id="project-description" [(ngModel)]="newProject.description" rows="4" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                        </div>
                    </div>
            
                    <!-- Información del Cliente -->
                    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Información del Cliente</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="client-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre del Cliente</label>
                                <input type="text" id="client-name" [(ngModel)]="newProject.clientName" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="client-company" class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
                                <input type="text" id="client-company" [(ngModel)]="newProject.clientCompany" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="client-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <input type="email" id="client-email" [(ngModel)]="newProject.clientEmail" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label for="client-phone" class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                                    <input type="tel" id="client-phone" [(ngModel)]="newProject.clientPhone" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="start-date" class="block text-sm font-medium text-gray-700 mb-1">Fecha de Inicio</label>
                                    <input type="date" id="start-date" [(ngModel)]="newProject.startDate" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label for="end-date" class="block text-sm font-medium text-gray-700 mb-1">Fecha de Entrega</label>
                                    <input type="date" id="end-date" [(ngModel)]="newProject.endDate" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sistema de Etiquetas/Tags -->
<div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
    <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Etiquetas</h3>
    <div class="space-y-3">
        <div>
            <div class="flex items-center space-x-2">
                <label for="new-tag" class="text-sm font-medium text-gray-700">Agregar etiqueta</label>
                <div class="relative flex-1 max-w-xs">
                    <input type="text" id="new-tag" [(ngModel)]="newTagText" placeholder="Ej: Urgente, Cliente VIP..." 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button (click)="addTag()" [disabled]="!newTagText.trim()" 
                        class="absolute right-1 top-1 p-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="text-lg">+</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="flex flex-wrap gap-2 mt-3">
            <div *ngFor="let tag of newProject.tags; let i = index" 
                class="flex items-center px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm">
                <span>{{tag}}</span>
                <button (click)="removeTag(i)" class="ml-2 text-blue-700 hover:text-blue-900">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <div *ngIf="newProject.tags.length === 0" class="text-sm text-gray-500 italic">
                No hay etiquetas definidas
            </div>
        </div>
        
        <div class="mt-2">
            <p class="text-xs text-gray-500">Las etiquetas te ayudarán a clasificar y encontrar más fácilmente tus proyectos</p>
        </div>
    </div>
</div>

<!-- Gestión de Archivos Adjuntos -->
<div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
    <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Archivos del Proyecto</h3>
    <div class="space-y-4">
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
            <div class="text-center space-y-2">
                <img src="https://img.icons8.com/fluency/48/upload.png" class="mx-auto w-8 h-8">
                <p class="text-sm text-gray-500">Arrastra archivos aquí o</p>
                <label for="file-upload" class="px-4 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm hover:bg-blue-100 cursor-pointer inline-block">
                    Seleccionar archivos
                </label>
                <input id="file-upload" type="file" multiple (change)="handleFileUpload($event)" class="hidden">
            </div>
            <p class="text-xs text-gray-500 text-center mt-2">Máximo 10MB por archivo. Formatos: PDF, DOC, JPG, PNG</p>
        </div>
        
        <div class="mt-4" *ngIf="newProject.files && newProject.files.length > 0">
            <h4 class="text-sm font-medium text-gray-700 mb-2">Archivos adjuntos</h4>
            <div class="space-y-2 max-h-64 overflow-y-auto">
                <div *ngFor="let file of newProject.files; let i = index" 
                    class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <img *ngIf="file.type.includes('image')" src="https://img.icons8.com/fluency/48/image.png" class="w-6 h-6">
                            <img *ngIf="file.type.includes('pdf')" src="https://img.icons8.com/fluency/48/pdf.png" class="w-6 h-6">
                            <img *ngIf="!file.type.includes('image') && !file.type.includes('pdf')" src="https://img.icons8.com/fluency/48/file.png" class="w-6 h-6">
                        </div>
                        <div class="flex-1 truncate">
                            <p class="text-sm font-medium text-gray-700 truncate">{{file.name}}</p>
                            <p class="text-xs text-gray-500">{{formatFileSize(file.size)}}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button *ngIf="file.type.includes('image')" (click)="previewFile(file)" 
                            class="p-1 text-blue-600 hover:text-blue-800 rounded">
                            <img src="https://img.icons8.com/fluency/48/visible.png" class="w-5 h-5">
                        </button>
                        <button (click)="removeFile(i)" class="p-1 text-red-600 hover:text-red-800 rounded">
                            <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hitos del Proyecto (Milestones) -->
<div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-base sm:text-lg font-semibold text-gray-900">Hitos del Proyecto</h3>
        <button (click)="addMilestone()" class="px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-sm hover:bg-blue-100">
            + Nuevo Hito
        </button>
    </div>
    <div class="space-y-3">
        <div *ngFor="let milestone of newProject.milestones; let i = index" class="p-3 border border-gray-200 rounded-lg">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                <div class="flex-1 grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Nombre del hito</label>
                        <input type="text" [(ngModel)]="milestone.name" placeholder="Ej: Entrega de diseños" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Fecha de entrega</label>
                        <input type="date" [(ngModel)]="milestone.date" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Porcentaje de pago</label>
                        <div class="relative">
                            <input type="number" [(ngModel)]="milestone.paymentPercentage" min="0" max="100" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500">
                            <span class="absolute right-3 top-2 text-gray-500">%</span>
                        </div>
                    </div>
                </div>
                <div>
                    <button (click)="removeMilestone(i)" class="p-1 text-red-600 hover:text-red-800 rounded">
                        <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                    </button>
                </div>
            </div>
            <div class="mt-2">
                <label class="block text-xs text-gray-500 mb-1">Descripción (opcional)</label>
                <textarea [(ngModel)]="milestone.description" rows="2" placeholder="Detalles importantes de este hito..." 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
            </div>
            <div class="mt-2 text-right">
                <span class="text-sm font-medium">Monto: ${{(newProject.totalBudget * (milestone.paymentPercentage/100)).toLocaleString('es-MX')}}</span>
            </div>
        </div>

        <div *ngIf="newProject.milestones.length === 0" class="text-center p-4 border border-dashed border-gray-300 rounded-lg">
            <p class="text-sm text-gray-500">No hay hitos definidos. Agrega hitos para establecer entregas y pagos parciales.</p>
        </div>

        <div *ngIf="getTotalMilestonePercentage() !== 100 && newProject.milestones.length > 0" class="mt-2 text-sm" 
            [ngClass]="getTotalMilestonePercentage() > 100 ? 'text-red-500' : 'text-yellow-500'">
            {{getTotalMilestonePercentage() > 100 ? 'Los porcentajes de pago exceden el 100%' : 'Los porcentajes de pago suman ' + getTotalMilestonePercentage() + '% (faltan ' + (100-getTotalMilestonePercentage()) + '%)'}}
        </div>
    </div>
</div>

<!-- Recursos Externos -->
<div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-base sm:text-lg font-semibold text-gray-900">Recursos Externos</h3>
        <button (click)="addResource()" class="px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-sm hover:bg-blue-100">
            + Nuevo Recurso
        </button>
    </div>
    
    <div class="space-y-3">
        <div *ngFor="let resource of newProject.resources; let i = index" class="p-3 border border-gray-200 rounded-lg">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                <div class="flex-1 grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Tipo de recurso</label>
                        <select [(ngModel)]="resource.type" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500">
                            <option value="hosting">Hosting</option>
                            <option value="domain">Dominio</option>
                            <option value="repo">Repositorio</option>
                            <option value="design">Diseño</option>
                            <option value="tool">Herramienta</option>
                            <option value="api">API / Servicio</option>
                            <option value="other">Otro</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Nombre</label>
                        <input type="text" [(ngModel)]="resource.name" placeholder="Ej: GitHub, Figma, AWS..." 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">URL</label>
                        <input type="url" [(ngModel)]="resource.url" placeholder="https://" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                </div>
                <div>
                    <button (click)="removeResource(i)" class="p-1 text-red-600 hover:text-red-800 rounded">
                        <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                    </button>
                </div>
            </div>
            
            <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Usuario/Acceso</label>
                    <input type="text" [(ngModel)]="resource.username" placeholder="Usuario (opcional)" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Contraseña/Token</label>
                    <div class="relative">
                        <input [type]="resource.showPassword ? 'text' : 'password'" [(ngModel)]="resource.password" placeholder="Contraseña (opcional)" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <button (click)="resource.showPassword = !resource.showPassword" class="absolute right-3 top-2 text-gray-500">
                            <img *ngIf="!resource.showPassword" src="https://img.icons8.com/fluency/48/visible.png" class="w-5 h-5">
                            <img *ngIf="resource.showPassword" src="https://img.icons8.com/fluency/48/hide.png" class="w-5 h-5">
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="mt-2">
                <label class="block text-xs text-gray-500 mb-1">Notas</label>
                <textarea [(ngModel)]="resource.notes" rows="2" placeholder="Información adicional sobre este recurso..." 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
            </div>
        </div>
        
        <div *ngIf="newProject.resources.length === 0" class="text-center p-4 border border-dashed border-gray-300 rounded-lg">
            <p class="text-sm text-gray-500">No hay recursos externos definidos. Agrega hosting, dominios, herramientas o APIs utilizadas.</p>
        </div>
    </div>
</div>
            
                    <!-- Presupuesto y Distribución -->
                    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Presupuesto y Distribución</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="total-budget" class="block text-sm font-medium text-gray-700 mb-1">Costo Total (MXN)</label>
                                <input type="number" id="total-budget" [(ngModel)]="newProject.totalBudget" (input)="calculateShares()" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <div class="flex items-center justify-between mb-2">
                                    <label class="text-sm font-medium text-gray-700">Distribución del Presupuesto</label>
                                    <button (click)="addTeamMember()" class="text-blue-600 text-sm hover:text-blue-800">
                                        + Agregar miembro
                                    </button>
                                </div>
                                <div class="space-y-3">
                                    <div *ngFor="let member of newProject.teamMembers; let i = index" class="p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-start gap-3">
                                            <div class="flex-1">
                                                <input type="text" [(ngModel)]="member.name" placeholder="Nombre" 
                                                    class="w-full mb-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <div class="flex gap-2">
                                                    <select [(ngModel)]="member.role" 
                                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <option value="frontend">Frontend</option>
                                                        <option value="backend">Backend</option>
                                                        <option value="design">Diseño</option>
                                                        <option value="pm">Project Manager</option>
                                                        <option value="qa">QA</option>
                                                    </select>
                                                    <div class="relative flex-1">
                                                        <input type="number" [(ngModel)]="member.percentage" (input)="calculateShares()" 
                                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                                            min="1" max="100">
                                                        <span class="absolute right-3 top-2 text-gray-500">%</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <button (click)="removeTeamMember(i)" class="p-1 hover:bg-gray-200 rounded">
                                                <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                                            </button>
                                        </div>
                                        <div class="mt-2 text-right">
                                            <span class="text-sm font-medium">Monto: ${{(newProject.totalBudget * (member.percentage/100)).toLocaleString('es-MX')}}</span>
                                        </div>
                                    </div>
                                </div>
                                <div *ngIf="getTotalPercentage() !== 100 && newProject.teamMembers.length > 0" class="mt-2 text-sm" 
                                    [ngClass]="getTotalPercentage() > 100 ? 'text-red-500' : 'text-yellow-500'">
                                    {{getTotalPercentage() > 100 ? 'La distribución excede el 100%' : 'La distribución es de ' + getTotalPercentage() + '% (faltan ' + (100-getTotalPercentage()) + '%)'}}
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Diseño y Recursos -->
                    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Diseño y Recursos</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Paleta de Colores</label>
                                <div class="flex flex-wrap gap-2">
                                    <div *ngFor="let color of newProject.design.colors; let i = index" class="relative">
                                        <!-- Use a direct reference to a local model variable to prevent shared binding -->
                                        <input type="color" [ngModel]="color" (ngModelChange)="newProject.design.colors[i] = $event" 
                                            class="w-10 h-10 border rounded cursor-pointer">
                                        <button (click)="removeColor(i)" *ngIf="newProject.design.colors.length > 1" 
                                            class="absolute -top-2 -right-2 bg-white rounded-full w-5 h-5 flex items-center justify-center border">
                                            <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-3 h-3">
                                        </button>
                                    </div>
                                    <button (click)="addColor()" 
                                        class="w-10 h-10 border border-dashed border-gray-300 rounded flex items-center justify-center hover:bg-gray-50">
                                        <span class="text-gray-500">+</span>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label for="typography" class="block text-sm font-medium text-gray-700 mb-1">Tipografía</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1">Títulos</p>
                                        <select [(ngModel)]="newProject.design.headingFont" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="sans">Sans-serif</option>
                                            <option value="serif">Serif</option>
                                            <option value="mono">Monospace</option>
                                            <option value="display">Display</option>
                                            <option value="other">Otro</option>
                                        </select>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1">Textos</p>
                                        <select [(ngModel)]="newProject.design.bodyFont" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="sans">Sans-serif</option>
                                            <option value="serif">Serif</option>
                                            <option value="mono">Monospace</option>
                                            <option value="other">Otro</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Logo del Cliente</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                    <div *ngIf="!newProject.design.logo" class="space-y-2">
                                        <img src="https://img.icons8.com/fluency/48/image.png" class="mx-auto w-8 h-8">
                                        <p class="text-sm text-gray-500">Arrastra un archivo o</p>
                                        <!-- Add the input for file and connect it to the handleLogoUpload function -->
                                        <input
                                            type="file"
                                            #logoFileInput
                                            accept="image/*"
                                            style="display: none;"
                                            (change)="handleLogoUpload($event)"
                                        >
                                        <button 
                                            class="px-4 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm hover:bg-blue-100"
                                            (click)="logoFileInput.click()">
                                            Seleccionar archivo
                                        </button>
                                    </div>
                                    <div *ngIf="newProject.design.logo" class="relative">
                                        <!-- Use SafeUrl pipe for the logo source -->
                                        <img [src]="newProject.design.logo" class="max-h-32 mx-auto">
                                        <button (click)="newProject.design.logo = null" 
                                            class="absolute top-1 right-1 bg-white rounded-full w-6 h-6 flex items-center justify-center shadow-sm">
                                            <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-4 h-4">
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- Tareas y Responsabilidades -->
                <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-900">Tareas y Responsabilidades</h3>
                        <button (click)="addTask()" class="px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-sm hover:bg-blue-100">
                            + Nueva Tarea
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarea</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Responsable</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha Inicio</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha Fin</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr *ngFor="let task of newProject.tasks; let i = index" class="hover:bg-gray-50">
                                    <td class="px-3 py-4 whitespace-nowrap">
                                        <input type="text" [(ngModel)]="task.name" placeholder="Nombre de la tarea" 
                                            class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    </td>
                                    <td class="px-3 py-4 whitespace-nowrap">
                                        <select [(ngModel)]="task.assignedTo" 
                                            class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                            <option value="">Seleccionar</option>
                                            <option *ngFor="let member of newProject.teamMembers" [value]="member.name">
                                                {{member.name}} ({{getRoleLabel(member.role)}})
                                            </option>
                                        </select>
                                    </td>
                                    <td class="px-3 py-4 whitespace-nowrap">
                                        <input type="date" [(ngModel)]="task.startDate" 
                                            class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    </td>
                                    <td class="px-3 py-4 whitespace-nowrap">
                                        <input type="date" [(ngModel)]="task.endDate" 
                                            class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    </td>
                                    <td class="px-3 py-4 whitespace-nowrap">
                                        <select [(ngModel)]="task.status" 
                                            class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                            <option value="pending">Pendiente</option>
                                            <option value="in-progress">En Progreso</option>
                                            <option value="review">En Revisión</option>
                                            <option value="completed">Completada</option>
                                        </select>
                                    </td>
                                    <td class="px-3 py-4 whitespace-nowrap text-right">
                                        <button (click)="removeTask(i)" class="text-red-500 hover:text-red-700">
                                            <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5 inline">
                                        </button>
                                    </td>
                                </tr>
                                <tr *ngIf="newProject.tasks.length === 0">
                                    <td colspan="6" class="px-3 py-4 text-center text-sm text-gray-500">
                                        No hay tareas asignadas. Haz clic en "Nueva Tarea" para comenzar.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            
                <!-- Notas y Comentarios Adicionales -->
                <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-4">Notas y Comentarios Adicionales</h3>
                    <textarea [(ngModel)]="newProject.notes" rows="5" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Escribe aquí cualquier información adicional, requisitos específicos, o notas importantes sobre el proyecto..."></textarea>
                </div>
            
                <!-- Botón de Guardar (versión móvil) -->
                <div class="sm:hidden">
                    <button
                        (click)="saveProject()"
                        class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center justify-center gap-2">
                        <img src="https://img.icons8.com/fluency/48/save.png" class="w-5 h-5 brightness-0 invert">
                        Guardar Proyecto
                    </button>
                </div>
            </div>

            <!-- Vista de Lista de Proyectos -->
<div *ngIf="currentView === 'projects'" class="space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <h1 class="text-lg sm:text-xl font-semibold text-gray-800">Proyectos</h1>
            <div class="w-full sm:w-auto flex gap-2">
                <div class="relative flex-1 sm:w-64">
                    <input type="text" [(ngModel)]="searchProjectText" placeholder="Buscar proyecto..." 
                        class="w-full px-3 py-2 pl-9 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <img src="https://img.icons8.com/fluency/48/search.png" class="w-5 h-5 absolute left-2 top-2.5 opacity-60">
                </div>
                <button (click)="changeView('new-project')" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/add-file.png" class="w-4 h-4 brightness-0 invert">
                    Nuevo Proyecto
                </button>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="bg-white rounded-xl shadow-sm p-4 border border-gray-100">
        <div class="flex flex-wrap items-center gap-3">
            <div class="text-sm font-medium text-gray-700">Filtrar por:</div>
            
            <div class="flex-1 flex flex-wrap gap-2">
                <button (click)="filterProjects('all')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentProjectFilter === 'all' ? 'bg-blue-50 text-blue-600 border-blue-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Todos
                </button>
                <button (click)="filterProjects('active')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentProjectFilter === 'active' ? 'bg-green-50 text-green-600 border-green-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Activos
                </button>
                <button (click)="filterProjects('completed')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentProjectFilter === 'completed' ? 'bg-purple-50 text-purple-600 border-purple-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Completados
                </button>
                <button (click)="filterProjects('overdue')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentProjectFilter === 'overdue' ? 'bg-red-50 text-red-600 border-red-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Vencidos
                </button>
            </div>
            
            <div class="flex items-center gap-2">
                <label for="project-sort" class="text-sm text-gray-600">Ordenar:</label>
                <select id="project-sort" [(ngModel)]="projectSortBy" (change)="sortProjects()" 
                    class="px-3 py-1 text-sm border border-gray-200 rounded-lg focus:outline-none">
                    <option value="date-desc">Más recientes</option>
                    <option value="date-asc">Más antiguos</option>
                    <option value="name-asc">Nombre (A-Z)</option>
                    <option value="name-desc">Nombre (Z-A)</option>
                    <option value="budget-desc">Mayor presupuesto</option>
                    <option value="budget-asc">Menor presupuesto</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Lista de Proyectos -->
    <div class="space-y-4">
        <div *ngFor="let project of filteredProjects()" 
            (click)="showProjectDetail(project)"
            class="bg-white rounded-xl shadow-sm border border-gray-100 hover:border-blue-200 transition-colors cursor-pointer">
            <!-- Contenido del proyecto -->
            <div class="p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h2 class="text-lg font-semibold text-gray-900">{{project.name}}</h2>
                            <span class="px-2 py-1 text-xs rounded-full"
                                [ngClass]="{
                                    'bg-green-100 text-green-700': project.status === 'active',
                                    'bg-purple-100 text-purple-700': project.status === 'completed',
                                    'bg-red-100 text-red-700': project.status === 'overdue',
                                    'bg-yellow-100 text-yellow-700': project.status === 'paused'
                                }">
                                {{getStatusLabel(project.status)}}
                            </span>
                        </div>
                        <div class="flex flex-wrap gap-2 mb-3">
                            <span *ngFor="let tag of project.tags" class="px-2 py-0.5 bg-blue-50 text-blue-600 rounded-full text-xs">
                                {{tag}}
                            </span>
                            <span *ngIf="!project.tags || project.tags.length === 0" class="text-xs text-gray-400 italic">
                                Sin etiquetas
                            </span>
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 text-sm">
                            <div>
                                <p class="text-gray-500">Cliente</p>
                                <p class="font-medium">{{project.clientCompany || project.clientName}}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">Tipo</p>
                                <p class="font-medium">{{getProjectTypeLabel(project.type)}}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">Presupuesto</p>
                                <p class="font-medium">${{project.totalBudget?.toLocaleString('es-MX') || 0}}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">Entrega</p>
                                <p class="font-medium">{{project.endDate | date:'dd/MM/yyyy'}}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Indicador de progreso -->
                    <div class="w-24 h-24 flex-shrink-0">
                        <div class="relative w-full h-full flex items-center justify-center">
                            <svg class="w-full h-full" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#eef2ff" stroke-width="10" />
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#3b82f6" stroke-width="10"
                                    stroke-dasharray="282.74" [attr.stroke-dashoffset]="282.74 - (282.74 * getProjectProgress(project) / 100)"
                                    transform="rotate(-90 50 50)" />
                            </svg>
                            <div class="absolute flex flex-col items-center justify-center">
                                <span class="text-xl font-bold text-gray-900">{{getProjectProgress(project)}}%</span>
                                <span class="text-xs text-gray-500">Completado</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Barra de equipo y acciones rápidas -->
                <div class="flex flex-col sm:flex-row items-center justify-between mt-5 pt-4 border-t border-gray-100">
                    <div class="flex items-center mb-3 sm:mb-0">
                        <div class="flex -space-x-2 mr-3">
                            <div *ngFor="let member of project.teamMembers.slice(0, 3)" 
                                class="w-8 h-8 rounded-full border-2 border-white overflow-hidden bg-gray-200 flex items-center justify-center" 
                                [ngStyle]="{'background-color': getRandomColor(member.name)}">
                                <span class="text-white font-medium text-sm">{{member.name.charAt(0)}}</span>
                            </div>
                            <div *ngIf="project.teamMembers.length > 3" 
                                class="w-8 h-8 rounded-full border-2 border-white bg-gray-100 flex items-center justify-center">
                                <span class="text-gray-500 text-xs">+{{project.teamMembers.length - 3}}</span>
                            </div>
                        </div>
                        <span class="text-sm text-gray-500">
                            {{project.teamMembers.length}} colaboradores
                        </span>
                    </div>
                    <div class="flex flex-wrap gap-2 justify-center sm:justify-end">
                        <button (click)="$event.stopPropagation(); changeProjectStatus(project)" 
                            class="px-2 py-1 border border-gray-200 rounded hover:bg-gray-50 text-xs flex items-center gap-1">
                            <img src="https://img.icons8.com/fluency/48/refresh.png" class="w-4 h-4">
                            Cambiar estado
                        </button>
                        <button (click)="$event.stopPropagation(); openAddTaskModal(project)" 
                            class="px-2 py-1 border border-gray-200 rounded hover:bg-gray-50 text-xs flex items-center gap-1">
                            <img src="https://img.icons8.com/fluency/48/task.png" class="w-4 h-4">
                            Añadir tarea
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estado vacío -->
        <div *ngIf="filteredProjects().length === 0" class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 text-center py-12">
            <img src="https://img.icons8.com/fluency/48/search-in-list.png" class="w-12 h-12 mx-auto mb-4 opacity-70">
            <h3 class="text-lg font-medium text-gray-900 mb-2">No se encontraron proyectos</h3>
            <p class="text-gray-500 max-w-md mx-auto mb-6">
                No hay proyectos que coincidan con tu búsqueda o filtros actuales. Intenta con otros términos o crea un nuevo proyecto.
            </p>
            <button (click)="changeView('new-project')" 
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm inline-flex items-center gap-2">
                <img src="https://img.icons8.com/fluency/48/add-file.png" class="w-4 h-4 brightness-0 invert">
                Crear Nuevo Proyecto
            </button>
        </div>
    </div>
</div>


<!-- Vista Detallada de Proyecto -->
<div *ngIf="currentView === 'project-detail' && selectedProject" class="space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
        <div class="flex flex-col sm:flex-row sm:items-start gap-4">
            <div class="flex items-center space-x-4">
                <button (click)="goBackToProjects()" class="p-2 hover:bg-gray-100 rounded-full">
                    <img src="https://img.icons8.com/fluency/48/back.png" class="w-5 h-5">
                </button>
                <div>
                    <div class="flex items-center flex-wrap gap-2">
                        <h2 class="text-lg font-semibold text-gray-900">{{selectedProject.name}}</h2>
                        <span class="px-2 py-0.5 text-xs rounded-full"
                            [ngClass]="{
                                'bg-green-100 text-green-700': selectedProject.status === 'active',
                                'bg-purple-100 text-purple-700': selectedProject.status === 'completed',
                                'bg-red-100 text-red-700': selectedProject.status === 'overdue',
                                'bg-yellow-100 text-yellow-700': selectedProject.status === 'paused'
                            }">
                            {{getStatusLabel(selectedProject.status)}}
                        </span>
                    </div>
                    <p class="text-sm text-gray-500">Cliente: {{selectedProject.clientCompany || selectedProject.clientName}}</p>
                </div>
            </div>
            <div class="flex flex-wrap gap-2 sm:ml-auto">
                <button (click)="changeProjectStatus(selectedProject)"
                    class="flex-1 sm:flex-none px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-sm flex items-center justify-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/refresh.png" class="w-4 h-4">
                    Cambiar estado
                </button>
                <button (click)="editProject(selectedProject)"
                    class="flex-1 sm:flex-none px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center justify-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/edit.png" class="w-4 h-4 brightness-0 invert">
                    Editar proyecto
                </button>
            </div>
        </div>
    </div>
    
    <!-- Resumen del Proyecto -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-base font-semibold text-gray-900">Progreso</h3>
                <span class="text-lg font-bold text-blue-600">{{getProjectProgress(selectedProject)}}%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                <div class="bg-blue-600 h-2.5 rounded-full" [style.width]="getProjectProgress(selectedProject) + '%'"></div>
            </div>
            <div class="flex justify-between text-sm">
                <span class="text-gray-500">Tareas completadas: {{getCompletedTasks(selectedProject)}}/{{selectedProject.tasks?.length || 0}}</span>
                <span class="text-gray-500">{{getDaysRemaining(selectedProject)}} días restantes</span>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
            <h3 class="text-base font-semibold text-gray-900 mb-3">Presupuesto</h3>
            <div class="flex flex-col">
                <div class="flex justify-between mb-2">
                    <span class="text-gray-500">Total:</span>
                    <span class="font-medium">${{selectedProject.totalBudget?.toLocaleString('es-MX') || 0}}</span>
                </div>
                <div class="flex justify-between mb-3">
                    <span class="text-gray-500">Próximo pago:</span>
                    <span class="font-medium">
                        <span *ngIf="getNextPayment(selectedProject) as nextPayment">
                            ${{nextPayment.amount?.toLocaleString('es-MX')}} ({{nextPayment.date | date:'dd/MM/yyyy'}})
                        </span>
                        <span *ngIf="!getNextPayment(selectedProject)">N/A</span>
                    </span>
                </div>
                <div *ngIf="getNextPayment(selectedProject)" 
                    [ngClass]="isPaymentOverdue(getNextPayment(selectedProject)) ? 'text-red-500' : 'text-green-500'"
                    class="text-xs">
                    <span *ngIf="isPaymentOverdue(getNextPayment(selectedProject))">
                        Pago vencido hace {{getDaysSince(getNextPayment(selectedProject).date)}} días
                    </span>
                    <span *ngIf="!isPaymentOverdue(getNextPayment(selectedProject))">
                        Faltan {{getDaysUntil(getNextPayment(selectedProject).date)}} días para el pago
                    </span>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
            <h3 class="text-base font-semibold text-gray-900 mb-3">Fechas clave</h3>
            <div class="flex flex-col space-y-2">
                <div class="flex justify-between">
                    <span class="text-gray-500">Inicio:</span>
                    <span class="font-medium">{{selectedProject.startDate | date:'dd/MM/yyyy'}}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500">Entrega:</span>
                    <span class="font-medium">{{selectedProject.endDate | date:'dd/MM/yyyy'}}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500">Próximo hito:</span>
                    <span class="font-medium">
                        <span *ngIf="getNextMilestone(selectedProject) as nextMilestone">
                            {{nextMilestone.name}} ({{nextMilestone.date | date:'dd/MM/yyyy'}})
                        </span>
                        <span *ngIf="!getNextMilestone(selectedProject)">N/A</span>
                    </span>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
            <h3 class="text-base font-semibold text-gray-900 mb-3">Equipo</h3>
            <div class="flex flex-col space-y-2">
                <div *ngFor="let member of selectedProject.teamMembers.slice(0, 3)" class="flex items-center space-x-2">
                    <div class="w-6 h-6 rounded-full overflow-hidden flex items-center justify-center" 
                        [ngStyle]="{'background-color': getRandomColor(member.name)}">
                        <span class="text-white text-xs font-medium">{{member.name.charAt(0)}}</span>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <p class="text-sm font-medium text-gray-900 truncate">{{member.name}}</p>
                        <p class="text-xs text-gray-500">{{getRoleLabel(member.role)}}</p>
                    </div>
                    <div class="text-sm font-medium text-gray-900">
                        {{member.percentage}}%
                    </div>
                </div>
                <div *ngIf="selectedProject.teamMembers.length > 3" class="text-center text-sm text-blue-600 hover:underline cursor-pointer mt-2" (click)="showAllTeamMembers()">
                    Ver todos ({{selectedProject.teamMembers.length}})
                </div>
                <div *ngIf="selectedProject.teamMembers.length === 0" class="text-sm text-gray-500 italic">
                    No hay miembros asignados
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pestañas de navegación -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="border-b border-gray-200">
            <nav class="flex">
                <button *ngFor="let tab of projectTabs" 
                    (click)="activeProjectTab = tab.id" 
                    class="px-4 py-3 text-sm font-medium border-b-2 transition-colors duration-200"
                    [ngClass]="activeProjectTab === tab.id 
                        ? 'border-blue-600 text-blue-600' 
                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
                    {{tab.name}}
                </button>
            </nav>
        </div>
        
        <!-- Información General -->
        <div *ngIf="activeProjectTab === 'info'" class="p-4 sm:p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Información del Proyecto</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-500">Nombre</p>
                            <p class="font-medium text-gray-900">{{selectedProject.name}}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Tipo de proyecto</p>
                            <p class="font-medium text-gray-900">{{getProjectTypeLabel(selectedProject.type)}}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Descripción</p>
                            <p class="font-medium text-gray-900 whitespace-pre-line">{{selectedProject.description}}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Etiquetas</p>
                            <div class="flex flex-wrap gap-2 mt-1">
                                <span *ngFor="let tag of selectedProject.tags" class="px-2 py-0.5 bg-blue-50 text-blue-600 rounded-full text-xs">
                                    {{tag}}
                                </span>
                                <span *ngIf="!selectedProject.tags || selectedProject.tags.length === 0" class="text-sm text-gray-400 italic">
                                    Sin etiquetas
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Información del Cliente</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-500">Nombre</p>
                            <p class="font-medium text-gray-900">{{selectedProject.clientName}}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Empresa</p>
                            <p class="font-medium text-gray-900">{{selectedProject.clientCompany}}</p>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500">Email</p>
                                <p class="font-medium text-gray-900">
                                    <a href="mailto:{{selectedProject.clientEmail}}" class="text-blue-600 hover:underline">
                                        {{selectedProject.clientEmail}}
                                    </a>
                                </p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Teléfono</p>
                                <p class="font-medium text-gray-900">
                                    <a href="tel:{{selectedProject.clientPhone}}" class="text-blue-600 hover:underline">
                                        {{selectedProject.clientPhone}}
                                    </a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Diseño</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-500 mb-2">Paleta de colores</p>
                            <div class="flex flex-wrap gap-2">
                                <div *ngFor="let color of selectedProject.design.colors" 
                                    class="w-8 h-8 rounded border shadow-sm" 
                                    [style.background-color]="color">
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500">Tipografía (Títulos)</p>
                                <p class="font-medium text-gray-900">{{getFontLabel(selectedProject.design.headingFont)}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Tipografía (Texto)</p>
                                <p class="font-medium text-gray-900">{{getFontLabel(selectedProject.design.bodyFont)}}</p>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 mb-2">Logo del cliente</p>
                            <div *ngIf="selectedProject.design.logo" class="mt-2 max-w-xs">
                                <img [src]="selectedProject.design.logo" alt="Logo del cliente" class="max-h-24">
                            </div>
                            <p *ngIf="!selectedProject.design.logo" class="text-sm text-gray-400 italic">
                                No hay logo disponible
                            </p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Notas</h3>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <p class="text-gray-900 text-sm whitespace-pre-line">{{selectedProject.notes || 'No hay notas adicionales para este proyecto.'}}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tareas y Responsabilidades -->
        <div *ngIf="activeProjectTab === 'tasks'" class="p-4 sm:p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Tareas y Responsabilidades</h3>
                <button (click)="openAddTaskModal(selectedProject)" 
                    class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 flex items-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/plus.png" class="w-4 h-4 brightness-0 invert">
                    Nueva Tarea
                </button>
            </div>
            
            <!-- Filtros de tareas -->
            <div class="flex flex-wrap gap-2 mb-4">
                <button (click)="filterTasks('all')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentTaskFilter === 'all' ? 'bg-blue-50 text-blue-600 border-blue-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Todas
                </button>
                <button (click)="filterTasks('pending')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentTaskFilter === 'pending' ? 'bg-yellow-50 text-yellow-600 border-yellow-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Pendientes
                </button>
                <button (click)="filterTasks('in-progress')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentTaskFilter === 'in-progress' ? 'bg-blue-50 text-blue-600 border-blue-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    En progreso
                </button>
                <button (click)="filterTasks('review')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentTaskFilter === 'review' ? 'bg-purple-50 text-purple-600 border-purple-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    En revisión
                </button>
                <button (click)="filterTasks('completed')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentTaskFilter === 'completed' ? 'bg-green-50 text-green-600 border-green-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Completadas
                </button>
            </div>
            
            <!-- Lista de tareas -->
            <div class="space-y-3">
                <div *ngFor="let task of filteredTasks(selectedProject); let i = index" 
                    class="bg-white border rounded-lg p-4 hover:border-blue-200 transition-colors">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                        <div class="flex items-start gap-3">
                            <div class="pt-1">
                                <div *ngIf="task.status === 'completed'" 
                                    class="w-5 h-5 rounded-full bg-green-100 border border-green-300 flex items-center justify-center">
                                    <img src="https://img.icons8.com/fluency/48/checkmark.png" class="w-3 h-3">
                                </div>
                                <div *ngIf="task.status !== 'completed'" 
                                    (click)="updateTaskStatus(selectedProject, i, 'completed')"
                                    class="w-5 h-5 rounded-full bg-white border border-gray-300 hover:border-green-400 cursor-pointer">
                                </div>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-base font-medium text-gray-900"
                                [ngStyle]="{ 'text-decoration': task.status === 'completed' ? 'line-through' : 'none' }">
                                {{ task.name }}
                            </h4>                            
                                <div class="flex flex-wrap gap-x-4 gap-y-2 mt-2 text-sm">
                                    <div class="flex items-center gap-1 text-gray-500">
                                        <img src="https://img.icons8.com/fluency/48/user.png" class="w-4 h-4">
                                        <span>{{task.assignedTo || 'Sin asignar'}}</span>
                                    </div>
                                    <div class="flex items-center gap-1 text-gray-500">
                                        <img src="https://img.icons8.com/fluency/48/calendar.png" class="w-4 h-4">
                                        <span>{{task.endDate | date:'dd/MM/yyyy'}}</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="px-2 py-0.5 text-xs rounded-full"
                                            [ngClass]="{
                                                'bg-yellow-100 text-yellow-700': task.status === 'pending',
                                                'bg-blue-100 text-blue-700': task.status === 'in-progress',
                                                'bg-purple-100 text-purple-700': task.status === 'review',
                                                'bg-green-100 text-green-700': task.status === 'completed'
                                            }">
                                            {{getTaskStatusLabel(task.status)}}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2 self-end sm:self-center">
                            <button (click)="openTaskDetailsModal(task)" 
                                class="p-1.5 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded">
                                <img src="https://img.icons8.com/fluency/48/visible.png" class="w-5 h-5">
                            </button>
                            <button (click)="openEditTaskModal(selectedProject, i)" 
                                class="p-1.5 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded">
                                <img src="https://img.icons8.com/fluency/48/edit.png" class="w-5 h-5">
                            </button>
                            <div class="relative" #taskStatusMenu>
                                <button (click)="toggleTaskStatusMenu(i)" 
                                    class="p-1.5 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded">
                                    <img src="https://img.icons8.com/fluency/48/menu-2.png" class="w-5 h-5">
                                </button>
                                <!-- Dropdown menu para cambiar estado -->
                                <div *ngIf="openTaskMenuIndex === i" 
                                    class="absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg z-10 border border-gray-200">
                                    <div class="py-1">
                                        <button (click)="updateTaskStatus(selectedProject, i, 'pending')" 
                                            class="w-full px-4 py-2 text-sm text-left text-gray-700 hover:bg-gray-100">
                                            Marcar como Pendiente
                                        </button>
                                        <button (click)="updateTaskStatus(selectedProject, i, 'in-progress')" 
                                            class="w-full px-4 py-2 text-sm text-left text-gray-700 hover:bg-gray-100">
                                            Marcar En Progreso
                                        </button>
                                        <button (click)="updateTaskStatus(selectedProject, i, 'review')" 
                                            class="w-full px-4 py-2 text-sm text-left text-gray-700 hover:bg-gray-100">
                                            Marcar En Revisión
                                        </button>
                                        <button (click)="updateTaskStatus(selectedProject, i, 'completed')" 
                                            class="w-full px-4 py-2 text-sm text-left text-gray-700 hover:bg-gray-100">
                                            Marcar como Completada
                                        </button>
                                        <div class="border-t border-gray-200"></div>
                                        <button (click)="deleteTask(selectedProject, i)" 
                                            class="w-full px-4 py-2 text-sm text-left text-red-600 hover:bg-red-50">
                                            Eliminar Tarea
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Estado vacío -->
                <div *ngIf="filteredTasks(selectedProject).length === 0" class="text-center py-10 border border-dashed border-gray-300 rounded-lg">
                    <img src="https://img.icons8.com/fluency/48/task.png" class="w-12 h-12 mx-auto mb-4 opacity-50">
                    <h4 class="text-lg font-medium text-gray-900 mb-2">No hay tareas</h4>
                    <p class="text-gray-500 max-w-md mx-auto mb-6">
                        No se encontraron tareas para este proyecto con los filtros actuales.
                    </p>
                    <button (click)="openAddTaskModal(selectedProject)" 
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm inline-flex items-center gap-2">
                        <img src="https://img.icons8.com/fluency/48/plus.png" class="w-4 h-4 brightness-0 invert">
                        Añadir Tarea
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Archivos del Proyecto -->
        <div *ngIf="activeProjectTab === 'files'" class="p-4 sm:p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Archivos del Proyecto</h3>
                <button (click)="openAddFileModal(selectedProject)" 
                    class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 flex items-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/upload.png" class="w-4 h-4 brightness-0 invert">
                    Subir archivo
                </button>
            </div>
            
            <!-- Categorías de archivos -->
            <div class="flex flex-wrap gap-2 mb-4">
                <button (click)="filterFiles('all')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentFileFilter === 'all' ? 'bg-blue-50 text-blue-600 border-blue-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Todos
                </button>
                <button (click)="filterFiles('image')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentFileFilter === 'image' ? 'bg-green-50 text-green-600 border-green-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Imágenes
                </button>
                <button (click)="filterFiles('document')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentFileFilter === 'document' ? 'bg-purple-50 text-purple-600 border-purple-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Documentos
                </button>
                <button (click)="filterFiles('other')" 
                    class="px-3 py-1 text-sm rounded-full border" 
                    [ngClass]="currentFileFilter === 'other' ? 'bg-yellow-50 text-yellow-600 border-yellow-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                    Otros
                </button>
            </div>
            
            <!-- Lista de archivos -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div *ngFor="let file of filteredFiles(selectedProject); let i = index" 
                    class="bg-white border rounded-lg p-4 hover:border-blue-200 transition-colors">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mr-3">
                            <!-- Iconos de tipo de archivo -->
                            <div *ngIf="file.type.includes('image')" class="w-12 h-12 bg-green-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/image.png" class="w-8 h-8">
                            </div>
                            <div *ngIf="file.type.includes('pdf')" class="w-12 h-12 bg-red-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/pdf.png" class="w-8 h-8">
                            </div>
                            <div *ngIf="file.type.includes('word') || file.type.includes('document')" class="w-12 h-12 bg-blue-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/microsoft-word-2019.png" class="w-8 h-8">
                            </div>
                            <div *ngIf="file.type.includes('sheet') || file.type.includes('excel')" class="w-12 h-12 bg-green-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/microsoft-excel-2019.png" class="w-8 h-8">
                            </div>
                            <div *ngIf="!file.type.includes('image') && !file.type.includes('pdf') && !file.type.includes('word') && !file.type.includes('document') && !file.type.includes('sheet') && !file.type.includes('excel')" 
                                class="w-12 h-12 bg-gray-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/file.png" class="w-8 h-8">
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="text-base font-medium text-gray-900 truncate">{{file.name}}</h4>
                            <p class="text-sm text-gray-500 mt-1">{{formatFileSize(file.size)}}</p>
                            <p class="text-xs text-gray-400 mt-1">Subido el {{file.uploadedAt | date:'dd/MM/yyyy'}}</p>
                        </div>
                    </div>
                    <div class="flex justify-end mt-3 pt-3 border-t border-gray-100">
                        <button *ngIf="file.type.includes('image')" (click)="previewFile(file)" 
                            class="p-1.5 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded mr-1">
                            <img src="https://img.icons8.com/fluency/48/visible.png" class="w-5 h-5">
                        </button>
                        <a [href]="file.url" target="_blank" download
                            class="p-1.5 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded mr-1">
                            <img src="https://img.icons8.com/fluency/48/download.png" class="w-5 h-5">
                        </a>
                        <button (click)="deleteFile(selectedProject, i)" 
                            class="p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded">
                            <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Estado vacío -->
            <div *ngIf="!selectedProject.fileReferences || selectedProject.fileReferences.length === 0" 
                class="text-center py-10 border border-dashed border-gray-300 rounded-lg">
                <img src="https://img.icons8.com/fluency/48/upload.png" class="w-12 h-12 mx-auto mb-4 opacity-50">
                <h4 class="text-lg font-medium text-gray-900 mb-2">No hay archivos</h4>
                <p class="text-gray-500 max-w-md mx-auto mb-6">
                    No se han subido archivos para este proyecto. Sube los documentos, imágenes o recursos del proyecto.
                </p>
                <button (click)="openAddFileModal(selectedProject)" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm inline-flex items-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/upload.png" class="w-4 h-4 brightness-0 invert">
                    Subir Archivo
                </button>
            </div>
        </div>
        
        <!-- Recursos Externos -->
        <div *ngIf="activeProjectTab === 'resources'" class="p-4 sm:p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Recursos Externos</h3>
                <button (click)="openAddResourceModal(selectedProject)" 
                    class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 flex items-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/plus.png" class="w-4 h-4 brightness-0 invert">
                    Añadir recurso
                </button>
            </div>
            
            <!-- Lista de recursos -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div *ngFor="let resource of selectedProject.resources; let i = index" 
                    class="bg-white border rounded-lg p-4 hover:border-blue-200 transition-colors">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mr-3">
                            <!-- Iconos por tipo de recurso -->
                            <div *ngIf="resource.type === 'hosting'" class="w-10 h-10 bg-blue-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/server.png" class="w-6 h-6">
                            </div>
                            <div *ngIf="resource.type === 'domain'" class="w-10 h-10 bg-green-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/domain.png" class="w-6 h-6">
                            </div>
                            <div *ngIf="resource.type === 'repo'" class="w-10 h-10 bg-purple-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/github.png" class="w-6 h-6">
                            </div>
                            <div *ngIf="resource.type === 'design'" class="w-10 h-10 bg-red-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/figma.png" class="w-6 h-6">
                            </div>
                            <div *ngIf="resource.type === 'tool' || resource.type === 'api' || resource.type === 'other'" 
                                class="w-10 h-10 bg-gray-100 rounded-lg p-2 flex items-center justify-center">
                                <img src="https://img.icons8.com/fluency/48/web.png" class="w-6 h-6">
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="text-base font-medium text-gray-900">{{resource.name}}</h4>
                            <a [href]="resource.url" target="_blank" class="text-blue-600 hover:underline text-sm truncate block">
                                {{resource.url}}
                            </a>
                            <div class="flex mt-2">
                                <span class="px-2 py-0.5 text-xs rounded-full bg-gray-100 text-gray-700">
                                    {{getResourceTypeLabel(resource.type)}}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div *ngIf="resource.username || resource.password" class="mt-3 p-3 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-2">
                            <div *ngIf="resource.username" class="flex justify-between items-center">
                                <span class="text-sm text-gray-500">Usuario:</span>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-medium">{{resource.username}}</span>
                                    <button (click)="copyToClipboard(resource.username)" 
                                        class="p-1 text-gray-500 hover:text-gray-800 hover:bg-gray-200 rounded">
                                        <img src="https://img.icons8.com/fluency/48/copy.png" class="w-4 h-4">
                                    </button>
                                </div>
                            </div>
                            <div *ngIf="resource.password" class="flex justify-between items-center">
                                <span class="text-sm text-gray-500">Contraseña:</span>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-medium">{{ resource.showPassword ? resource.password : '••••••••' }}</span>
                                    <button (click)="resource.showPassword = !resource.showPassword" 
                                        class="p-1 text-gray-500 hover:text-gray-800 hover:bg-gray-200 rounded">
                                        <img *ngIf="!resource.showPassword" src="https://img.icons8.com/fluency/48/visible.png" class="w-4 h-4">
                                        <img *ngIf="resource.showPassword" src="https://img.icons8.com/fluency/48/hide.png" class="w-4 h-4">
                                    </button>
                                    <button (click)="copyToClipboard(resource.password)" 
                                        class="p-1 text-gray-500 hover:text-gray-800 hover:bg-gray-200 rounded">
                                        <img src="https://img.icons8.com/fluency/48/copy.png" class="w-4 h-4">
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div *ngIf="resource.notes" class="mt-3 text-sm text-gray-600">
                        <p class="whitespace-pre-line">{{resource.notes}}</p>
                    </div>
                    
                    <div class="flex justify-end mt-3 pt-3 border-t border-gray-100">
                        <button (click)="editResource(selectedProject, i)" 
                            class="p-1.5 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded mr-1">
                            <img src="https://img.icons8.com/fluency/48/edit.png" class="w-5 h-5">
                        </button>
                        <button (click)="deleteResource(selectedProject, i)" 
                            class="p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded">
                            <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Estado vacío -->
            <div *ngIf="!selectedProject.resources || selectedProject.resources.length === 0" 
                class="text-center py-10 border border-dashed border-gray-300 rounded-lg">
                <img src="https://img.icons8.com/fluency/48/web.png" class="w-12 h-12 mx-auto mb-4 opacity-50">
                <h4 class="text-lg font-medium text-gray-900 mb-2">No hay recursos externos</h4>
                <p class="text-gray-500 max-w-md mx-auto mb-6">
                    No se han agregado recursos externos como hosting, dominios, repositorios o herramientas de diseño.
                </p>
                <button (click)="openAddResourceModal(selectedProject)" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm inline-flex items-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/plus.png" class="w-4 h-4 brightness-0 invert">
                    Añadir Recurso
                </button>
            </div>
        </div>
        
        <!-- Hitos del Proyecto -->
        <div *ngIf="activeProjectTab === 'milestones'" class="p-4 sm:p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Hitos del Proyecto</h3>
                <button (click)="openAddMilestoneModal(selectedProject)" 
                    class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 flex items-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/plus.png" class="w-4 h-4 brightness-0 invert">
                    Añadir hito
                </button>
            </div>
            
            <!-- Línea de tiempo -->
            <div class="relative border-l-2 border-blue-200 pl-6 pb-6 ml-4">
                <div *ngFor="let milestone of selectedProject.milestones; let i = index" class="mb-8 relative">
                    <!-- Marcador en la línea de tiempo -->
                    <div class="absolute w-8 h-8 rounded-full flex items-center justify-center -left-10 bg-white border-2" 
                        [ngClass]="milestone.completed ? 'border-green-400 bg-green-50' : 'border-blue-400'">
                        <span *ngIf="milestone.completed" class="text-green-500">
                            <img src="https://img.icons8.com/fluency/48/checkmark.png" class="w-5 h-5">
                        </span>
                        <span *ngIf="!milestone.completed" class="text-blue-500 font-medium text-sm">
                            {{i + 1}}
                        </span>
                    </div>
                    
                    <!-- Contenido del hito -->
                    <div class="bg-white border rounded-lg p-4 hover:border-blue-200 transition-colors">
                        <div class="flex flex-col sm:flex-row sm:items-start justify-between gap-3">
                            <div>
                                <div class="flex items-center gap-2">
                                    <h4 class="text-base font-medium text-gray-900">{{milestone.name}}</h4>
                                    <span *ngIf="milestone.completed" class="px-2 py-0.5 text-xs rounded-full bg-green-100 text-green-700">
                                        Completado
                                    </span>
                                    <span *ngIf="!milestone.completed && isMilestoneOverdue(milestone)" class="px-2 py-0.5 text-xs rounded-full bg-red-100 text-red-700">
                                        Vencido
                                    </span>
                                    <span *ngIf="!milestone.completed && !isMilestoneOverdue(milestone)" class="px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-700">
                                        Pendiente
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 mt-2">{{milestone.description}}</p>
                                <div class="flex flex-wrap gap-x-4 gap-y-2 mt-3 text-sm">
                                    <div class="flex items-center gap-1 text-gray-500">
                                        <img src="https://img.icons8.com/fluency/48/calendar.png" class="w-4 h-4">
                                        <span>{{milestone.date | date:'dd/MM/yyyy'}}</span>
                                    </div>
                                    <div class="flex items-center gap-1 text-gray-500">
                                        <img src="https://img.icons8.com/fluency/48/money.png" class="w-4 h-4">
                                        <span>Pago: {{milestone.paymentPercentage}}% (${{selectedProject.totalBudget * milestone.paymentPercentage / 100 | number:'1.0-0'}}&#125;)</span>                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-2 self-end sm:self-start">
                                <button *ngIf="!milestone.completed" (click)="completeMilestone(selectedProject, i)" 
                                    class="p-1.5 text-green-500 hover:text-green-700 hover:bg-green-50 rounded mr-1" 
                                    title="Marcar como completado">
                                    <img src="https://img.icons8.com/fluency/48/checkmark.png" class="w-5 h-5">
                                </button>
                                <button (click)="editMilestone(selectedProject, i)" 
                                    class="p-1.5 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded mr-1">
                                    <img src="https://img.icons8.com/fluency/48/edit.png" class="w-5 h-5">
                                </button>
                                <button (click)="deleteMilestone(selectedProject, i)" 
                                    class="p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded">
                                    <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Estado vacío -->
            <div *ngIf="!selectedProject.milestones || selectedProject.milestones.length === 0" 
                class="text-center py-10 border border-dashed border-gray-300 rounded-lg">
                <img src="https://img.icons8.com/fluency/48/flag.png" class="w-12 h-12 mx-auto mb-4 opacity-50">
                <h4 class="text-lg font-medium text-gray-900 mb-2">No hay hitos definidos</h4>
                <p class="text-gray-500 max-w-md mx-auto mb-6">
                    No se han definido hitos para este proyecto. Agregar hitos te ayudará a organizar los entregables y pagos.
                </p>
                <button (click)="openAddMilestoneModal(selectedProject)" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm inline-flex items-center gap-2">
                    <img src="https://img.icons8.com/fluency/48/plus.png" class="w-4 h-4 brightness-0 invert">
                    Añadir Hito
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para agregar/editar tarea -->
<div *ngIf="showTaskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-lg max-w-lg w-full mx-auto p-4 sm:p-6" (click)="$event.stopPropagation()">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">{{editingTaskIndex === -1 ? 'Agregar Tarea' : 'Editar Tarea'}}</h3>
            <button (click)="closeTaskModal()" class="p-1 hover:bg-gray-100 rounded">
                <img src="https://img.icons8.com/fluency/48/close-window.png" class="w-6 h-6">
            </button>
        </div>
        <div class="space-y-4">
            <div>
                <label for="task-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre de la tarea</label>
                <input type="text" id="task-name" [(ngModel)]="currentTask.name" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label for="task-description" class="block text-sm font-medium text-gray-700 mb-1">Descripción (opcional)</label>
                <textarea id="task-description" [(ngModel)]="currentTask.description" rows="3" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="task-assigned" class="block text-sm font-medium text-gray-700 mb-1">Asignar a</label>
                    <select id="task-assigned" [(ngModel)]="currentTask.assignedTo" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">No asignado</option>
                        <option *ngFor="let member of selectedProject.teamMembers" [value]="member.name">
                            {{member.name}} ({{getRoleLabel(member.role)}})
                        </option>
                    </select>
                </div>
                <div>
                    <label for="task-status" class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
                    <select id="task-status" [(ngModel)]="currentTask.status" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="pending">Pendiente</option>
                        <option value="in-progress">En Progreso</option>
                        <option value="review">En Revisión</option>
                        <option value="completed">Completada</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="task-start-date" class="block text-sm font-medium text-gray-700 mb-1">Fecha de inicio</label>
                    <input type="date" id="task-start-date" [(ngModel)]="currentTask.startDate" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="task-end-date" class="block text-sm font-medium text-gray-700 mb-1">Fecha de finalización</label>
                    <input type="date" id="task-end-date" [(ngModel)]="currentTask.endDate" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
        </div>
        <div class="flex justify-end gap-2 mt-6">
            <button (click)="closeTaskModal()" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                Cancelar
            </button>
            <button (click)="saveTask()" 
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                {{editingTaskIndex === -1 ? 'Agregar Tarea' : 'Guardar Cambios'}}
            </button>
        </div>
    </div>
</div>

<!-- Modal para subir archivos -->
<div *ngIf="showFileModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-lg max-w-lg w-full mx-auto p-4 sm:p-6" (click)="$event.stopPropagation()">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Subir Archivo</h3>
            <button (click)="closeFileModal()" class="p-1 hover:bg-gray-100 rounded">
                <img src="https://img.icons8.com/fluency/48/close-window.png" class="w-6 h-6">
            </button>
        </div>
        <div class="space-y-4">
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                <div class="text-center space-y-2">
                    <img src="https://img.icons8.com/fluency/48/upload.png" class="mx-auto w-8 h-8">
                    <p class="text-sm text-gray-500">Arrastra archivos aquí o</p>
                    <label for="file-upload-modal" class="px-4 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm hover:bg-blue-100 cursor-pointer inline-block">
                        Seleccionar archivos
                    </label>
                    <input id="file-upload-modal" type="file" multiple (change)="onFileSelected($event)" class="hidden">
                </div>
                <p class="text-xs text-gray-500 text-center mt-2">Máximo 10MB por archivo</p>
            </div>
            
            <div *ngIf="selectedFiles.length > 0" class="mt-4">
                <h4 class="text-sm font-medium text-gray-700 mb-2">Archivos seleccionados</h4>
                <div class="space-y-2 max-h-48 overflow-y-auto">
                    <div *ngFor="let file of selectedFiles; let i = index" 
                        class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <img *ngIf="file.type.includes('image')" src="https://img.icons8.com/fluency/48/image.png" class="w-5 h-5 mr-2">
                            <img *ngIf="file.type.includes('pdf')" src="https://img.icons8.com/fluency/48/pdf.png" class="w-5 h-5 mr-2">
                            <img *ngIf="!file.type.includes('image') && !file.type.includes('pdf')" src="https://img.icons8.com/fluency/48/file.png" class="w-5 h-5 mr-2">
                            <div>
                                <p class="text-sm font-medium truncate max-w-xs">{{file.name}}</p>
                                <p class="text-xs text-gray-500">{{formatFileSize(file.size)}}</p>
                            </div>
                        </div>
                        <button (click)="removeSelectedFile(i)" class="text-red-500 hover:text-red-700">
                            <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="flex justify-end gap-2 mt-6">
            <button (click)="closeFileModal()" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                Cancelar
            </button>
            <button (click)="uploadFiles()" [disabled]="selectedFiles.length === 0 || isUploading"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
                <div *ngIf="isUploading" class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>
                Subir Archivos
            </button>
        </div>
    </div>
</div>

<!-- Modal para agregar/editar recursos -->
<div *ngIf="showResourceModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-lg max-w-lg w-full mx-auto p-4 sm:p-6" (click)="$event.stopPropagation()">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">{{editingResourceIndex === -1 ? 'Añadir Recurso' : 'Editar Recurso'}}</h3>
            <button (click)="closeResourceModal()" class="p-1 hover:bg-gray-100 rounded">
                <img src="https://img.icons8.com/fluency/48/close-window.png" class="w-6 h-6">
            </button>
        </div>
        <div class="space-y-4">
            <div>
                <label for="resource-type" class="block text-sm font-medium text-gray-700 mb-1">Tipo de recurso</label>
                <select id="resource-type" [(ngModel)]="currentResource.type" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="hosting">Hosting</option>
                    <option value="domain">Dominio</option>
                    <option value="repo">Repositorio</option>
                    <option value="design">Diseño</option>
                    <option value="tool">Herramienta</option>
                    <option value="api">API / Servicio</option>
                    <option value="other">Otro</option>
                </select>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="resource-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
                    <input type="text" id="resource-name" [(ngModel)]="currentResource.name" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="resource-url" class="block text-sm font-medium text-gray-700 mb-1">URL</label>
                    <input type="url" id="resource-url" [(ngModel)]="currentResource.url" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="resource-username" class="block text-sm font-medium text-gray-700 mb-1">Usuario (opcional)</label>
                    <input type="text" id="resource-username" [(ngModel)]="currentResource.username" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="resource-password" class="block text-sm font-medium text-gray-700 mb-1">Contraseña (opcional)</label>
                    <div class="relative">
                        <input [type]="showPassword ? 'text' : 'password'" id="resource-password" [(ngModel)]="currentResource.password" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button (click)="showPassword = !showPassword" class="absolute right-3 top-2 text-gray-500">
                            <img *ngIf="!showPassword" src="https://img.icons8.com/fluency/48/visible.png" class="w-5 h-5">
                            <img *ngIf="showPassword" src="https://img.icons8.com/fluency/48/hide.png" class="w-5 h-5">
                        </button>
                    </div>
                </div>
            </div>
            <div>
                <label for="resource-notes" class="block text-sm font-medium text-gray-700 mb-1">Notas (opcional)</label>
                <textarea id="resource-notes" [(ngModel)]="currentResource.notes" rows="3" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Información adicional, detalles de configuración, etc."></textarea>
            </div>
        </div>
        <div class="flex justify-end gap-2 mt-6">
            <button (click)="closeResourceModal()" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                Cancelar
            </button>
            <button (click)="saveResource()" 
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                {{editingResourceIndex === -1 ? 'Añadir Recurso' : 'Guardar Cambios'}}
            </button>
        </div>
    </div>
</div>

<!-- Modal para agregar/editar hitos -->
<div *ngIf="showMilestoneModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-lg max-w-lg w-full mx-auto p-4 sm:p-6" (click)="$event.stopPropagation()">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">{{editingMilestoneIndex === -1 ? 'Añadir Hito' : 'Editar Hito'}}</h3>
            <button (click)="closeMilestoneModal()" class="p-1 hover:bg-gray-100 rounded">
                <img src="https://img.icons8.com/fluency/48/close-window.png" class="w-6 h-6">
            </button>
        </div>
        <div class="space-y-4">
            <div>
                <label for="milestone-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre del hito</label>
                <input type="text" id="milestone-name" [(ngModel)]="currentMilestone.name" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label for="milestone-description" class="block text-sm font-medium text-gray-700 mb-1">Descripción (opcional)</label>
                <textarea id="milestone-description" [(ngModel)]="currentMilestone.description" rows="3" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="milestone-date" class="block text-sm font-medium text-gray-700 mb-1">Fecha de entrega</label>
                    <input type="date" id="milestone-date" [(ngModel)]="currentMilestone.date" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="milestone-payment" class="block text-sm font-medium text-gray-700 mb-1">Porcentaje de pago</label>
                    <div class="relative">
                        <input type="number" id="milestone-payment" [(ngModel)]="currentMilestone.paymentPercentage" min="0" max="100" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <span class="absolute right-3 top-2 text-gray-500">%</span>
                    </div>
                </div>
            </div>
            <div *ngIf="editingMilestoneIndex !== -1" class="flex items-center mt-2">
                <input type="checkbox" id="milestone-completed" [(ngModel)]="currentMilestone.completed" class="mr-2">
                <label for="milestone-completed" class="text-sm text-gray-700">Marcar como completado</label>
            </div>
            <div *ngIf="currentMilestone.paymentPercentage > 0" class="text-sm text-gray-600 mt-2">
                Monto correspondiente: ${{selectedProject.totalBudget * currentMilestone.paymentPercentage / 100 | number:'1.0-0'}}
            </div>
            <div *ngIf="getTotalMilestonePercentageForEdit() > 100" class="text-sm text-red-500 mt-1">
                ¡Advertencia! El total de porcentajes de pago excede el 100% ({{getTotalMilestonePercentageForEdit()}}%)
            </div>
        </div>
        <div class="flex justify-end gap-2 mt-6">
            <button (click)="closeMilestoneModal()" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                Cancelar
            </button>
            <button (click)="saveMilestone()" 
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                {{editingMilestoneIndex === -1 ? 'Añadir Hito' : 'Guardar Cambios'}}
            </button>
        </div>
    </div>
</div>
<!-- Vista de Clientes Potenciales -->
<div *ngIf="currentView === 'potential-clients'" class="space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <h1 class="text-lg sm:text-xl font-semibold text-gray-800">Clientes Potenciales</h1>
            <div class="w-full sm:w-auto flex gap-2">
                <div class="relative flex-1 sm:w-64">
                    <input type="text" [(ngModel)]="searchClientText" placeholder="Buscar cliente..." 
                        class="w-full px-3 py-2 pl-9 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <img src="https://img.icons8.com/fluency/48/search.png" class="w-5 h-5 absolute left-2 top-2.5 opacity-60">
                </div>
                <label for="excel-upload" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center justify-center gap-2 cursor-pointer">
                    <img src="https://img.icons8.com/fluency/48/upload.png" class="w-4 h-4 brightness-0 invert">
                    Cargar Excel
                </label>
                <input id="excel-upload" type="file" accept=".xlsx, .xls, .csv" (change)="onExcelFileSelected($event)" class="hidden">
            </div>
        </div>
    </div>

    <!-- Estado sin datos -->
    <div *ngIf="!clientsData || clientsData.length === 0" class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 text-center py-12">
        <img src="https://img.icons8.com/fluency/48/business.png" class="w-16 h-16 mx-auto mb-4 opacity-70">
        <h3 class="text-lg font-medium text-gray-900 mb-2">No hay clientes potenciales</h3>
        <p class="text-gray-500 max-w-md mx-auto mb-6">
            Carga un archivo Excel con datos de clientes potenciales para visualizar y analizar la información.
        </p>
        <label for="excel-upload-empty" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm inline-flex items-center gap-2 cursor-pointer">
            <img src="https://img.icons8.com/fluency/48/upload.png" class="w-4 h-4 brightness-0 invert">
            Cargar archivo Excel
        </label>
        <input id="excel-upload-empty" type="file" accept=".xlsx, .xls, .csv" (change)="onExcelFileSelected($event)" class="hidden">
        <p class="text-xs text-gray-500 mt-4">
            El archivo debe contener columnas para: nombre, sitio web, enlace de ubicación y tipo de negocio.
        </p>
    </div>

    <!-- Datos cargados -->
    <div *ngIf="clientsData && clientsData.length > 0" class="space-y-6">
        <!-- Dashboard de métricas -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Total Clientes</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1">{{clientsData.length}}</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                        <img src="https://img.icons8.com/fluency/48/business.png" class="w-6 h-6">
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Con Sitio Web</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1">{{getClientsWithWebsite()}}</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                        <img src="https://img.icons8.com/fluency/48/domain.png" class="w-6 h-6">
                    </div>
                </div>
                <div class="mt-4 flex items-center text-sm">
                    <span class="text-green-500">{{getPercentage(getClientsWithWebsite(), clientsData.length)}}%</span>
                    <span class="text-gray-400 ml-2">del total</span>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Con Ubicación</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1">{{getClientsWithLocation()}}</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                        <img src="https://img.icons8.com/fluency/48/map-pin.png" class="w-6 h-6">
                    </div>
                </div>
                <div class="mt-4 flex items-center text-sm">
                    <span class="text-yellow-500">{{getPercentage(getClientsWithLocation(), clientsData.length)}}%</span>
                    <span class="text-gray-400 ml-2">del total</span>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Giros de Negocio</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1">{{getUniqueBusinessTypes().length}}</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                        <img src="https://img.icons8.com/fluency/48/diversity.png" class="w-6 h-6">
                    </div>
                </div>
                <div class="mt-4 flex items-center text-sm">
                    <span class="text-purple-500 flex items-center">
                        <img src="https://img.icons8.com/fluency/48/categorize.png" class="w-4 h-4 mr-1">
                        Categorías únicas
                    </span>
                </div>
            </div>
        </div>

        <!-- Gráficos -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Gráfico de distribución por tipo de negocio -->
            <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                <h3 class="text-base font-semibold text-gray-900 mb-4">Distribución por Giro de Negocio</h3>
                <div class="h-64 w-full">
                    <!-- Aquí va el gráfico, si usas una librería como Chart.js o ngx-charts -->
                    <div *ngIf="businessTypeChart && businessTypeChart.length > 0; else noChartData" class="w-full h-full">
                        <canvas id="businessTypeChart"></canvas>
                    </div>
                    <ng-template #noChartData>
                        <div class="w-full h-full flex items-center justify-center text-gray-500">
                            No hay suficientes datos para mostrar el gráfico
                        </div>
                    </ng-template>
                </div>
            </div>

            <!-- Gráfico de presencia web y ubicación -->
            <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 border border-gray-100">
                <h3 class="text-base font-semibold text-gray-900 mb-4">Presencia Digital</h3>
                <div class="h-64 w-full">
                    <!-- Aquí va el gráfico, si usas una librería como Chart.js o ngx-charts -->
                    <div class="w-full h-full">
                        <canvas id="presenceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="bg-white rounded-xl shadow-sm p-4 border border-gray-100">
            <div class="flex flex-wrap items-center gap-3">
                <div class="text-sm font-medium text-gray-700">Filtrar por:</div>
                
                <div class="flex-1 flex flex-wrap gap-2">
                    <button (click)="filterClients('all')" 
                        class="px-3 py-1 text-sm rounded-full border" 
                        [ngClass]="currentClientFilter === 'all' ? 'bg-blue-50 text-blue-600 border-blue-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                        Todos
                    </button>
                    <button (click)="filterClients('with-website')" 
                        class="px-3 py-1 text-sm rounded-full border" 
                        [ngClass]="currentClientFilter === 'with-website' ? 'bg-green-50 text-green-600 border-green-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                        Con Sitio Web
                    </button>
                    <button (click)="filterClients('no-website')" 
                        class="px-3 py-1 text-sm rounded-full border" 
                        [ngClass]="currentClientFilter === 'no-website' ? 'bg-red-50 text-red-600 border-red-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                        Sin Sitio Web
                    </button>
                    <button (click)="filterClients('with-location')" 
                        class="px-3 py-1 text-sm rounded-full border" 
                        [ngClass]="currentClientFilter === 'with-location' ? 'bg-yellow-50 text-yellow-600 border-yellow-200' : 'border-gray-200 text-gray-600 hover:bg-gray-50'">
                        Con Ubicación
                    </button>
                </div>
                
                <div class="flex items-center gap-2">
                    <label for="business-type-filter" class="text-sm text-gray-600">Giro:</label>
                    <select id="business-type-filter" [(ngModel)]="selectedBusinessType" (change)="applyBusinessTypeFilter()" 
                        class="px-3 py-1 text-sm border border-gray-200 rounded-lg focus:outline-none">
                        <option value="all">Todos los giros</option>
                        <option *ngFor="let type of getUniqueBusinessTypes()" [value]="type">{{type}}</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Tabla de clientes -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Nombre
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Giro de Negocio
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Sitio Web
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Ubicación
                            </th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr *ngFor="let client of filteredClients()" class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">{{client.name}}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full"
                                    [ngClass]="getBusinessTypeClass(client.types)">
                                    {{client.types}}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900 flex items-center">
                                    <span *ngIf="client.website && client.website.trim()" class="inline-flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                        <a [href]="formatWebsiteUrl(client.website)" target="_blank" class="text-blue-600 hover:underline">
                                            {{client.website}}
                                        </a>
                                    </span>
                                    <span *ngIf="!client.website || !client.website.trim()" class="inline-flex items-center">
                                        <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                                        <span>No disponible</span>
                                    </span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">
                                    <a *ngIf="client.place_link && client.place_link.trim()" 
                                       [href]="client.place_link" 
                                       target="_blank" 
                                       class="text-blue-600 hover:underline flex items-center">
                                        <img src="https://img.icons8.com/fluency/48/map-pin.png" class="w-4 h-4 mr-1">
                                        Ver ubicación
                                    </a>
                                    <span *ngIf="!client.place_link || !client.place_link.trim()" class="text-gray-500">
                                        No disponible
                                    </span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button (click)="convertToContact(client)" class="text-blue-600 hover:text-blue-900 mr-3">
                                    Convertir a Contacto
                                </button>
                                <button (click)="createQuotation(client)" class="text-green-600 hover:text-green-900">
                                    Crear Cotización
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Estado vacío para búsqueda sin resultados -->
            <div *ngIf="filteredClients().length === 0" class="text-center py-10">
                <img src="https://img.icons8.com/fluency/48/search-in-list.png" class="w-12 h-12 mx-auto mb-4 opacity-70">
                <h3 class="text-lg font-medium text-gray-900 mb-2">No se encontraron clientes</h3>
                <p class="text-gray-500 max-w-md mx-auto">
                    No hay clientes que coincidan con tu búsqueda o filtros actuales. Intenta con otros términos.
                </p>
            </div>
        </div>
        
        <!-- Exportar y Acciones -->
        <div class="flex justify-end space-x-4">
            <button (click)="exportToExcel()" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-sm flex items-center gap-2">
                <img src="https://img.icons8.com/fluency/48/microsoft-excel-2019.png" class="w-5 h-5">
                Exportar a Excel
            </button>
            <button (click)="clearData()" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-sm flex items-center gap-2">
                <img src="https://img.icons8.com/fluency/48/delete-sign.png" class="w-5 h-5">
                Limpiar Datos
            </button>
        </div>
    </div>
</div>
                                        </main>
    </div>
</div>

